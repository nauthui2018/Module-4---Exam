<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Title Page-->
    <title>List Employee</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css"
          integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g=="
          crossorigin="anonymous" />

    <!-- Fontfaces CSS-->
    <link href="../css/font-face.css" rel="stylesheet" media="all">
    <link href="../vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="../vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="../vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="../css/theme.css" rel="stylesheet" media="all">
    <style>
        #toast-container {
            color: darkorange;
        }
    </style>
</head>

<body class="animsition">
<div class="page-wrapper">
    <!-- MENU SIDEBAR-->
    <aside class="menu-sidebar2">
        <div class="logo">
            <a href="#">
                <img src="../images/icon/logo-white.png" alt="Cool Admin" />
            </a>
        </div>
        <div class="menu-sidebar2__content js-scrollbar1">
            <nav class="navbar-sidebar2">
                <ul class="list-unstyled navbar__list">
                    <li class="active has-sub">
                        <a href="/employee"/><i class="fas fa-table"></i>Employees</a>
                    </li>
                    <li class="has-sub">
                        <a href="/group"><i class="fas fa-table"></i>Groups</a>
                    </li>
                </ul>
            </nav>
        </div>
    </aside>
    <!-- END MENU SIDEBAR-->

    <!-- PAGE CONTAINER-->
    <div class="page-container2">
        <!-- HEADER DESKTOP-->
        <header class="header-desktop2">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="header-wrap2">
                        <div class="logo d-block d-lg-none">
                            <a href="#">
                                <img src="../images/icon/logo-white.png" alt="CoolAdmin" />
                            </a>
                        </div>
                        <div class="header-button2">
                            <div class="header-button-item mr-0 js-sidebar-btn">
                                <i class="zmdi zmdi-menu"></i>
                            </div>
                            <div class="setting-menu js-right-sidebar d-none d-lg-block">
                                <div class="account-dropdown__body">
                                    <div class="account-dropdown__item">
                                        <a href="/logout"><i class="fas fa-sign-out-alt mr-3"></i>Logout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <aside class="menu-sidebar2 js-right-sidebar d-block d-lg-none">
            <div class="logo">
                <a href="#">
                    <img src="../images/icon/logo-white.png" alt="Cool Admin" />
                </a>
            </div>
            <div class="menu-sidebar2__content js-scrollbar2">
                <nav class="navbar-sidebar2">
                    <ul class="list-unstyled navbar__list">
                        <li class="active has-sub">
                            <a href="/employee"/><i class="fas fa-table"></i>Employees</a>
                        </li>
                        <li class="has-sub">
                            <a href="/group"/><i class="fas fa-table"></i>Groups</a>
                        </li>
                        <li class="has-sub">
                            <a href="/logout"/><i class="fas fa-sign-out-alt mr-3"></i>Logout</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END HEADER DESKTOP-->

        <!-- BREADCRUMB-->
        <section class="au-breadcrumb m-t-75">
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="au-breadcrumb-content">
                                <div class="au-breadcrumb-left mt-1">
                                    <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">
                                        <i class="zmdi zmdi-plus mr-1"></i>New Employee</button>
                                </div>
                                <div class="au-breadcrumb-right m-b-10">
                                    <a class="btn btn-primary btn-sm" href="/employee">Home page</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END BREADCRUMB-->

        <section>
            <div class="section__content section__content--p30">
                <div class="container-fluid">
                    <div class="row m-t-30">
                        <div class="col-md-12">
                            <!-- DATA TABLE-->
                            <div class="table-responsive m-b-40">
                                <table class="table table-borderless table-data3" id="employeeTable">
                                    <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Group</th>
                                        <th>Name</th>
                                        <th>Gender</th>
                                        <th>Mobile</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody id="table">
                                    </tbody>
                                </table>
                            </div>
                            <!-- END DATA TABLE-->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="copyright">
                            <p>Copyright Â© 2018 Colorlib. All rights reserved. Template by <a href="https://colorlib.com">Colorlib</a>.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END PAGE CONTAINER-->
    </div>

    <!-- Modal Create -->
    <div class="modal" id="myModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Create new employee</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <form id="myForm">
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Name</label>
                            </div>
                            <div class="col-9">
                                <input type="text" id="name" name="name" class="form-control" required>
                                <p style="color: red;display: none" class="ui-state-error-text"></p>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label for="group">Group</label>
                            </div>
                            <div class="col-9">
                                <select class="form-control" id="group" name="group">
                                </select>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>DOB</label>
                            </div>
                            <div class="col-9">
                                <input type="date" id="dob" name="dob" class="form-control" required>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Gender</label>
                            </div>
                            <div class="col-9">
                                <select class="form-control" id="gender" name="gender">
                                    <option value=0>Male</option>
                                    <option value=1>Female</option>
                                    <option value=2>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Mobile</label>
                            </div>
                            <div class="col-9">
                                <input type="text" id="mobile" name="mobile" class="form-control" required>
                                <p style="color: red;display: none" class="ui-state-error-text"></p>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Personal ID</label>
                            </div>
                            <div class="col-9">
                                <input type="text" id="personalID" name="personalID" class="form-control" required>
                                <p style="color: red;display: none" class="ui-state-error-text"></p>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Email</label>
                            </div>
                            <div class="col-9">
                                <input type="email" id="email" name="email" class="form-control" required>
                                <p style="color: red;display: none" class="ui-state-error-text"></p>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-3">
                                <label>Address</label>
                            </div>
                            <div class="col-9">
                                <input type="text" id="address" name="address" class="form-control" required>
                                <p style="color: red;display: none" class="ui-state-error-text"></p>
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-9">
                                <input type="hidden" id="id" class="form-control" required>
                            </div>
                        </div>
                        <!-- Modal footer -->
                        <div class="modal-footer">
                            <input type="submit" class="btn btn-primary" onclick="return employees.create()"
                                   id="submit" value="Save">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js" integrity="sha512-UdIMMlVx0HEynClOIFSyOrPggomfhBKJE28LKl8yR3ghkgugPnG6iLfRfHwushZl1MOPSY6TsuBDGPK2X4zYKg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>

<!-- Datatable JS-->
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>

<script>
    var employees = {} || employees;
    var groups = {} || groups;
    var groupArray = [];
    employees.drawTable = function () {
        $("#employeeTable").DataTable({
            destroy: true,
            "lengthMenu": [5, 10, 20, 50],
            ajax: {
                url: 'http://localhost:8080/api/employee',
                method: "GET",
                datatype: "json",
                dataSrc: ""
            },
            columns: [
                { data: "id" , name: "id", title: "ID",orderable: true},
                { data: "group.name", name : "group" , title: "Group", sortable: false},
                { data: "name", name : "name" , title: "Name", sortable: true},
                { data: "gender", name : "gender" , title: "Gender", sortable: false, "render":function (data) {
                        return employees.viewGender(data);
                    }},
                { data: "mobile", name : "mobile" , title: "Mobile", sortable: false},
                { data: "id", name : "Action", title : "Action",sortable: false,
                    orderable: false ,"render": function ( data, type, row, meta ) {
                        var str = "<a href='javascript:;' title='Edit' onclick='employees.get("+ data +")' data-toggle=\"modal\" data-target=\"#myModal\" style=\"color: darkorange\">" +
                            "<i class='fa fa-edit mr-1'></i>Edit</a> " +
                            "<a class='ml-1' href='javascript:;' title='Remove' onclick='employees.remove("+ data +")'  style=\"color: red\">" +
                            "<i class='fa fa-trash mr-1'></i>Delete</a>"
                        return str ;
                    }
                }
            ]
        });
    };

    employees.remove = function (id) {
        bootbox.confirm({
            message: "Do you want to delete this employee?",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    $.ajax({
                        url: "http://localhost:8080/api/employee/" + id,
                        method: "DELETE", //"POST"
                        dataType: 'json',
                        success: function (data) {
                            employees.drawTable();
                            toastr.warning('Employee has been deleted successfully', 'INFORMATION:')
                        }
                    });
                }
            }
        });
    }

    employees.create = function () {
        if ($('#myForm').valid()) {
            var employee = {};
            employee.name = $('#name').val();
            employee.group = groups.findById(parseInt($('#group').val()));
            employee.dob = $('#dob').val();
            employee.gender = $('#gender').val();
            employee.mobile = $('#mobile').val();
            employee.personalID = $('#personalID').val();
            employee.email = $('#email').val();
            employee.address = $('#address').val();
            if($('#id').val() === "0") { //Add new
                $.ajax({
                    url: "http://localhost:8080/api/employee",
                    method: "POST", //"POST"
                    dataType: 'json',
                    contentType: "application/json",
                    data: JSON.stringify(employee),
                    success: function (data) {
                        toastr.success('Customer has been created successfully', 'INFORMATION:');
                        $('#myModal').modal('hide');
                        employees.drawTable();
                    }
                })
            } else {
                employee.id = $('#id').val();
                $.ajax({
                    url: "http://localhost:8080/api/employee",
                    method: "PUT",
                    dataType: 'json',
                    contentType: "application/json",
                    data: JSON.stringify(employee),
                    success: function (data) {
                        toastr.success('Customer has been updated successfully', 'INFORMATION:');
                        $('#myModal').modal('hide');
                        employees.drawTable();
                    }
                });
            }
        }
        employees.reset();
        return false;
    }

    employees.get = function (id) {
        $.ajax({
            url: "http://localhost:8080/api/employee/" + id,
            method: "GET",
            dateType: "json",
            success: function (data) {
                $('#id').val(data.id);
                $('#name').val(data.name);
                $('#group').val(data.group.id);
                $('#dob').val(data.dob);
                $('#gender').val(data.gender.toString());
                $('#mobile').val(data.mobile);
                $('#personalID').val(data.personalID);
                $('#email').val(data.email);
                $('#address').val(data.address);
                $('#myModal').find('.modal-title').text('Update employee');
                $('#submit').text("Update");
            }
        })
    }

    groups.listGroups = function () {
        $.ajax({
            url: "http://localhost:8080/api/group",
            method: "GET",
            dataType: "json",
            success: function (data) {
                groupArray = data;
                $.each(data, function (i, v) {
                    $('#group').append(
                        `<option value='${v.id}'>${v.name}</option>`
                    );
                });
                employees.reset();
            }
        });
    }

    groups.findById = function (id) {
        for (let i = 0; i < groupArray.length; i++) {
            if (id === groupArray[i].id) {
                return groupArray[i];
            }
        }
        return null;
    }

    employees.reset = function () {
        $('#name').val('');
        $('#group').val(0);
        $('#dob').val('');
        $('#gender').val('');
        $('#mobile').val('');
        $('#personalID').val('');
        $('#email').val('');
        $('#address').val('');
        $('#myModal').find('.modal-title').text('Create new employee');
        $('#submit').text("Save");
    }

    $(document).ready(function () {
        employees.drawTable();
        groups.listGroups();
        $('#myForm').validate({
            rules: {
                name: {
                    required: true,
                    minlength: 5,
                    maxlength: 30,
                },
                group: "required",
                dob: "required",
                gender: "required",
                mobile: {
                    required: true,
                    regex: "^[0-9]{10}$",
                },
                personalID: "required",
                email: {
                    required: true,
                    regex: "[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,64}",
                },
                address: "required",
            },
            messages: {
                name: "Please input your name!!!",
                group: "Please select your group!!!",
                dob: "Please select your DOB!!!",
                gender: "Please select your gender!!!",
                mobile: "Please input your mobile!!!",
                personalID: "Please input your personal ID!!!",
                email: "Please input your email again!!!",
                address: "Please input your address!!!",
            }
        });
    });

    employees.viewGender = function (gender) {
        switch (gender) {
            case 0:
                return "Male";
                break;
            case 1:
                return "Female";
                break;
            case 2:
                return  "Other";
                break;
            default:
                return  "Not chose gender";
        }
    }

    $.validator.addMethod(
        "regex",
        function(value, element, regexp) {
            var re = new RegExp(regexp);
            return this.optional(element) || re.test(value);
        },
        "Please check your input."
    );

</script>
</body>

</html>
<!-- end document-->
